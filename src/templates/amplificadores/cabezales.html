{% extends "inner_page.html" %}

{% block stylesheets %}

{% endblock %}

{% block content %}
<!-- title -->
<div class="products-right">
  <h5 class="mb-1">Cabezales</h5>
</div>
<!-- //title -->

<!-- progress -->
<div class='progress' style="margin-top: 15px;">
  <div class="progress-bar bg-custom progress-bar-striped active" style="width:100%"></div>
</div>
<!-- //progress -->

<!-- myTable -->
<table id="myTable"></table>
<template id="profileTemplate">
  <div class="col-md-3 product-men mb-3" style="margin-bottom: 15px;">
    <div class="men-pro-item simpleCart_shelfItem">
      <div class="men-thumb-item">
        <img src="%photo_front%" alt="" class="pro-image-front" />
        <img src="%photo_back%" alt="" class="pro-image-back" />
        <div class="men-cart-pro">
          <div class="inner-men-cart-pro">
            <a href="#" class="link-product-add-cart">Ver Producto</a>
          </div>
        </div>
        <span class="product-new-top">New</span>
      </div>
      <div class="item-info-product">
        <h4 style="padding-inline: 12px;">
          <a href="#" title="%description%">%description_sort%</a>
        </h4>
        <div class="info-product-price">
          <span class="item_price">%price%
          </span>
        </div>
        <a href="#" class="item_add single-item hvr-outline-out button2">Agregar al Carrito</a>
      </div>
    </div>
  </div>
</template>
<!-- //myTable -->
<hr style="margin-block: 60px;">
{% endblock %}

{% block javascripts %}
<script
  src="https://unpkg.com/bootstrap-table@1.21.3/dist/extensions/custom-view/bootstrap-table-custom-view.js"></script>
<script>
  $(function () {
    $("#myTable").bootstrapTable({
      url: '/get_productos/6',
      locale: 'es-CL',
      search: true,
      searchAlign: 'left',
      pageSize: 8,
      pagination: true,
      paginationPreText: 'Anterior',
      paginationNextText: 'Siguiente',
      paginationVAlign: "both",
      showCustomView: true,
      customView: (data) => {
        // Agregamos el HTML para cargar los datos
        var view = ""
        var template = $("#profileTemplate").html()
        var description_sort = ""
        var formatter = new Intl.NumberFormat("es-CL", { style: "currency", currency: "CLP", })
        // Recorremos datos
        $.each(data, function (i, row) {
          if (row.description.length > 40) {
            description_sort = row.description.substring(0, 40) + "..."
          } else {
            description_sort = row.description
          }
          view += template
            .replace("%description%", row.description)
            .replace("%description_sort%", description_sort)
            .replace("%photo%", row.photo)
            .replace("%photo_front%", row.photo)
            .replace("%photo_back%", row.photo)
            .replace("%price%", formatter.format(row.price))
        });
        // Retornamos un row con colum
        return `<div class="row">${view}</div>`;
      },
      onLoadSuccess: (number, size) => {
        $(".progress").hide();
        $(".search-input").show()
      },
      onPageChange: (number, size) => {
        window.scrollTo(0, 0)
      },
    });

    $(".fixed-table-body, .search-input").hide()
    $("[name='customView']").click().remove()
  })
</script>
{% endblock %}