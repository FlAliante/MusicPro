<script type="application/x-javascript">
  addEventListener("load", function() { setTimeout(hideURLbar, 0); }, false);
  function hideURLbar() {
    window.scrollTo(0,1);
  }
</script>
<!-- jQuery -->
<script src="{{ url_for('static', filename='js/jquery-2.1.4.min.js') }}"></script>

<!-- simpleCart -->
<script src="{{ url_for('static', filename='js/simpleCart.min.js') }}"></script>

<!-- Bootstrap -->
<script src="{{ url_for('static', filename='js/bootstrap-3.1.1.min.js') }}"></script>

<!-- jQuery Easing -->
<script src="{{ url_for('static', filename='js/jquery.easing.min.js') }}"></script>


<!-- <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script> -->

<script src="https://unpkg.com/bootstrap-table@1.19.1/dist/bootstrap-table.min.js"></script>
<script src="https://unpkg.com/bootstrap-table@1.19.1/dist/bootstrap-table-locale-all.min.js"></script>
<script
  src="https://unpkg.com/bootstrap-table@1.19.1/dist/extensions/custom-view/bootstrap-table-custom-view.js"></script>

<script>
  var compra_total = localStorage.getItem('compra_total');
  var compra_item = localStorage.getItem('compra_item');
  var compra_formato = localStorage.getItem('compra_formato');
  var compra_productos = localStorage.getItem('compra_productos');
  var formatter = new Intl.NumberFormat("es-CL", { style: "currency", currency: "CLP", })

  function agregarAlCarrito(precio, description, photo, id) {
    //parseo textos a numeros para sumar
    precio = parseInt(precio);
    compra_total = parseInt(compra_total);
    //Recupero txt y parseo a json
    compra_productos = JSON.parse(compra_productos);
    // Incrementa el número actual en 1 cada vez que se llama esta función
    compra_total += precio
    compra_item++
    // Crear un objeto para almacenar
    var objeto = {
      'precio': precio,
      'description': description,
      'photo': photo,
      'format': formatter.format(precio),
      'id' : id,
    }
    //Adjunto datos 
    compra_productos.push(objeto)
    // Esto transforma a json tipo text. si no se guarda asi el array no se puede acceder despues
    compra_productos = JSON.stringify(compra_productos)
    // Escribe el nuevo número asignado en el almacenamiento local
    localStorage.setItem('compra_total', compra_total);
    localStorage.setItem('compra_item', compra_item);
    localStorage.setItem('compra_productos', compra_productos);
    // Actualiza el contenido del elemento HTML que muestra el número asignado
    $('#compra_total').text(formatter.format(compra_total))
    $('#compra_item').text(compra_item).show()
  }

  function limpiarCarrito() {
    compra_total = 0;
    compra_item = 0;
    compra_productos = '[]'

    localStorage.setItem('compra_total', compra_total);
    localStorage.setItem('compra_item', compra_item);
    localStorage.setItem('compra_productos', compra_productos);

    $('#compra_total').text('$' + compra_total);
    $('#compra_item').text(compra_item)
  }

  $(function () {
    // Si no hay un número previo en el almacenamiento local, establece el número inicial en 0
    if (!compra_item) {
      compra_total = 0;
      compra_item = 0;
      compra_productos = '[]'
    }

    $('#compra_total').text(formatter.format(compra_total))
    $('#compra_item').text(compra_item)


    if ($('#compra_item').text() != 0) {
      $('#compra_item').show();

    }

    $('#vaciar_carrito').on('click', function () {
      $('#carrito_tabla, #compra_item').hide();
      $('#carrito_msj').show();
    });
  });
</script>