{% extends "inner_page.html" %}

{% block content %}
<!-- check out -->
<div class="">
	<div class="container">
		<div class="table-responsive checkout-right animated wow slideInUp" data-wow-delay=".5s">
			<table id="tabla" class="timetable_sub">
				<thead>
					<tr>
						<th>Remove</th>
						<th>Product</th>
						<th>Quantity</th>
						<th>Product Name</th>
						<th>Price</th>
					</tr>
				</thead>
			</table>
			<template id="miNuevoElemento">
				<tr>
					<td>
						<center>
							<span style="cursor: pointer;">Eliminar</span>
						</center>
					</td>
					<td class="invert-image" style="width: 300px;">
						<a href="#"><img src="%photo%" alt="%description%" class="img-responsive" /></a>
					</td>
					<td class="invert">
						<div class="quantity">
							<div class="quantity-select">
								<div class="entry value-minus">&nbsp;</div>
								<div class="entry value"><span>1</span></div>
								<div class="entry value-plus active">&nbsp;</div>
							</div>
						</div>
					</td>
					<td class="invert">%description%</td>
					<td class="invert">%format%</td>
				</tr>
			</template>
		</div>

		<div id="carrito_msj" style="padding-top: 30px;">
			<center>
				<h3>Tu carrito esta vacio</h3>
			</center>
		</div>

		<div id="carrito_pagar" style="display: none;" class="checkout-left">
			<div class="checkout-left-basket animated wow slideInLeft" style="margin-left: 10px; cursor:pointer">
				<h4>Pagar: <span id="tarifa"></span></li>
				</h4>
			</div>

			<div class="checkout-left-basket animated wow slideInLeft" style="margin-left: 10px; cursor:pointer">
				<h4 style="background: black;">Transformar a USD</li>
				</h4>
			</div>
		</div>

	</div>
</div>

<hr>

<!-- //check out -->
{% endblock %}

{% block javascripts %}

<!--quantity-->
<script>
	$('.value-plus').on('click', function () {
		var divUpd = $(this).parent().find('.value'), newVal = parseInt(divUpd.text(), 10) + 1;
		divUpd.text(newVal);
	});

	$('.value-minus').on('click', function () {
		var divUpd = $(this).parent().find('.value'), newVal = parseInt(divUpd.text(), 10) - 1;
		if (newVal >= 1) divUpd.text(newVal);
	});
</script>
<!--quantity-->

<script>
	$.ajax({
		url: 'https://music-pro-api.herokuapp.com/exchange_rate',
		data: { amount_clp: 7000 },
		success: function (response) {
			console.log(response);
			// Haz algo con la respuesta...
		},
		error: function (jqXHR, status, errorThrown) {
			console.error(errorThrown);
		}
	});

	$(function () {
		// Parsear el string JSON a un objeto JavaScript
		var productos = JSON.parse(compra_productos);
		if (productos.length > 0) {
			$('#carrito_msj').hide();
			// Seleccionar la tabla por su clase (en este caso, se usa la clase "table")
			var tabla = $('#tabla');
			var html = '';
			// Iterar sobre los elementos del array con forEach()
			productos.forEach(function (producto, indice) {
				html = $('#miNuevoElemento').html()
					.replaceAll('%format%', producto.format)
					.replaceAll('%description%', producto.description)
					.replaceAll('%photo%', producto.photo)
				tabla.append(html);
			});
			$('#tarifa').text($('#compra_total').text())
			$('#carrito_pagar').show();
		}
	})
</script>
{% endblock %}